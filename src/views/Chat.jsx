import { useContext } from "react";
import { ChatContext } from "../context/ChatContext";
import { AuthContext } from "../context/AuthContext";
import UserChat from "../components/chat-components/UserChat";
import FutureChat from "../components/chat-components/FutureChat";
import Chatbox from "../components/chat-components/Chatbox";
import { Link } from "react-router-dom";
import Notification from "../components/chat-components/Notification";

const Chat  = () => {
    const {userChats, isUserChatsLoading, updateCurrentChat, allUsers } = useContext(ChatContext);
    const { user, logoutUser } = useContext(AuthContext);
    const allUserValue = allUsers.length;
   
    return (
        <>
        {/* { userChats?.length < 1 ? null :  */}
        <div>
        <div className="w-3/4 flex justify-center items-center h-screen antialiased text-gray-800 ml-auto mr-auto">
        <div className="flex flex-row h-full w-full overflow-x-hidden">
        <div className="flex flex-col py-8 pl-6 pr-2 w-64 bg-white flex-shrink-0">
            <div
            className="flex flex-col items-center bg-indigo-100 border border-gray-200 mt-4 w-full py-6 px-4 rounded-lg"
            >
            <div className="h-20 w-20 rounded-full border overflow-hidden">
            <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500" className="w-35 h-35">
                 <path d="m369.97,246.09c.63-3.96.98-8,.98-12.11,0-50.27-48.41-91.16-107.92-91.16-20.95,0-40.52,5.09-57.09,13.86-.07.04-.15.08-.22.12-1.64.87-3.24,1.78-4.81,2.72,0,0-.01,0-.01,0-5.89,3.52-11.34,7.51-16.28,11.93h0c-12.4,11.09-21.56,24.78-26.16,40.01h0c-1.69,5.59-2.75,11.38-3.15,17.32h0c-.12,1.73-.19,3.46-.19,5.21,0,2.26.13,4.5.33,6.72h0c.16,1.81.38,3.6.66,5.38h171.63c-.38-.92-.74-1.87-1.2-2.72-2.87-5.31-6.58-9.68-10.99-13-4.52-3.38-9.41-5.88-14.52-7.42-5.4-1.63-10.89-2.89-16.32-3.75-5.4-.86-10.99-1.66-16.63-2.36-5.77-.72-11.15-2.04-16-3.92-4.41-1.63-8.08-3.83-10.87-6.54-3.1-2.99-4.67-7.01-4.67-11.94,0-4.35,1.19-7.98,3.54-10.81,2.17-2.6,4.88-4.7,8.05-6.24,3.08-1.5,6.35-2.5,9.72-2.99,6.14-.92,11.08-.95,16.72-.12,2.68.41,5.19,1.03,7.48,1.84l2.07.73v2.19c0,5.75,1.66,10.02,5.06,13.07,3.5,3.11,7.41,4.63,11.95,4.63,2.64,0,4.83-.47,6.52-1.41,1.84-1.02,3.39-2.32,4.61-3.86,1.26-1.56,2.17-3.36,2.73-5.35.6-2.14.9-4.28.9-6.39,0-5.3-1.6-9.58-4.75-12.72-3.44-3.44-7.71-6.13-12.68-7.99-5.15-1.94-10.65-3.25-16.33-3.9-5.74-.66-10.84-.99-15.14-.99-.5,0-.99.04-1.48.04-.08,0-.14-.04-.22-.04h-40.7c11.89-4.03,24.86-6.26,38.45-6.26,56.72,0,102.86,38.63,102.86,86.11,0,4.11-.37,8.15-1.04,12.11h5.11Zm-183.79-69.26h24.02c-1.26,1.64-2.45,3.33-3.5,5.14-1.22,2.12-2.22,4.39-3.02,6.79h-28.14c3.13-4.24,6.7-8.23,10.63-11.93Zm-14.3,17.32h30.4c-.6,3.08-.91,6.34-.91,9.77,0,.75.07,1.43.1,2.16h-35.72c1.69-4.13,3.74-8.11,6.14-11.93Zm-8.12,17.32h38.19c.59,4.08,1.64,7.73,3.25,10.81.2.39.45.74.67,1.12h-44.89c.6-4.07,1.53-8.06,2.79-11.93Zm-3.25,29.24c-.21-2.22-.34-4.46-.34-6.72,0-1.75.08-3.48.21-5.21h49.2c1.79,2.11,3.82,4,6.1,5.63,3.51,2.5,7.34,4.6,11.38,6.3h-66.54Zm74.32-81.19c-4.96,1.85-9.57,4.15-13.69,6.96-2.18,1.49-4.17,3.19-6.05,4.97h-22.67c5.76-4.56,12.15-8.57,19.05-11.93h23.36Zm-91.36,69.26h-36.32c-1.49,0-2.69-1.2-2.69-2.69s1.21-2.69,2.69-2.69h36.79c.48-4.05,1.27-8.03,2.29-11.93h-62.03c-1.49,0-2.69-1.21-2.69-2.69s1.2-2.69,2.69-2.69h63.62c1.34-4.08,2.93-8.07,4.83-11.93H52.25c-1.48,0-2.69-1.21-2.69-2.69s1.2-2.69,2.69-2.69h103.26c2.36-4.14,5.03-8.12,8-11.93h-85.22c-1.49,0-2.69-1.2-2.69-2.69s1.21-2.69,2.69-2.69h89.73c3.79-4.25,7.97-8.24,12.47-11.93h-53c-1.49,0-2.69-1.2-2.69-2.69s1.21-2.69,2.69-2.69h60.07c20.61-14.44,46.89-23.12,75.48-23.12,66.01,0,119.71,46.19,119.71,102.96,0,4.1-.31,8.13-.85,12.11h-8.52c.6-3.97.94-8,.94-12.11,0-52.13-49.92-94.54-111.29-94.54-21.87,0-42.26,5.41-59.48,14.7-1.54.83-3.06,1.7-4.55,2.59,0,0-.01,0-.02.01-1.49.9-2.95,1.82-4.39,2.78-5.4,3.59-10.4,7.58-14.93,11.94-1.81,1.73-3.55,3.52-5.2,5.37-3.38,3.77-6.44,7.76-9.14,11.94-1.13,1.76-2.18,3.55-3.18,5.38-2.12,3.85-3.96,7.84-5.45,11.95-.64,1.77-1.21,3.56-1.73,5.37-1.12,3.89-1.97,7.88-2.5,11.94-.23,1.77-.42,3.56-.54,5.36-.11,1.73-.18,3.47-.18,5.22,0,4.11.34,8.14.94,12.11h-32.8c-1.49,0-2.69-1.2-2.69-2.69s1.21-2.69,2.69-2.69h23.71c-.18-2.22-.29-4.46-.29-6.72,0-1.74.05-3.48.15-5.21Zm306.97,73.66H107.76v2.54h68.71c21.82,19.67,52.53,31.97,86.56,31.97s64.74-12.3,86.56-31.97h100.85v-2.54Zm-187.53,11.64c9.05,0,17.84-.97,26.1-2.87,6.1-1.39,11.68-3.53,16.77-6.23h15.25c-16.53,9.5-36.47,15.12-57.99,15.12s-41.46-5.62-57.99-15.12h14.35c18.52,8.46,38.29,9.1,43.53,9.1Zm.12,14.45c-28.09,0-53.75-8.91-73.36-23.55h5.8c18.51,12.6,42,20.17,67.56,20.17s49.05-7.58,67.56-20.17h5.8c-19.61,14.64-45.27,23.55-73.36,23.55Zm-166.17-28.91c-2.35,1.54-5.08,2.67-8.12,3.37-3.12.72-6.43,1.08-9.83,1.08-1.79,0-3.95-.11-6.42-.34-2.43-.22-4.93-.65-7.44-1.28-2.45-.63-4.8-1.52-6.99-2.64-1.92-.99-3.46-2.23-4.57-3.71l.62-7.24c1.32.9,2.7,1.7,4.14,2.39,2.13,1.02,4.35,1.86,6.62,2.47,2.25.61,4.5,1.07,6.7,1.36,2.18.29,4.28.44,6.23.44,1.12,0,2.36-.06,3.73-.17,1.43-.12,2.8-.42,4.05-.89,1.28-.48,2.4-1.16,3.33-2.01,1.06-.99,1.6-2.33,1.6-4,0-2.01-.79-3.62-2.35-4.78-1.33-.99-3.08-1.83-5.22-2.5-1.77-.53-3.65-1-5.57-1.39-1.91-.39-3.84-.84-5.78-1.35-1.91-.5-3.79-1.1-5.58-1.79-1.76-.68-3.39-1.56-4.88-2.62-1.65-1.18-2.97-2.72-3.92-4.55-.95-1.82-1.44-4.14-1.44-6.88,0-3.17.67-5.94,2-8.24,1.35-2.33,3.18-4.29,5.42-5.82,2.28-1.56,4.93-2.73,7.88-3.49,2.99-.76,6.15-1.15,9.38-1.15,1.63,0,3.55.13,5.7.37,2.15.25,4.21.74,6.15,1.47,1.86.69,3.46,1.7,4.75,2.99,1.19,1.19,1.76,2.73,1.76,4.74,0,.79-.11,1.59-.34,2.39-.21.74-.54,1.4-1.01,1.98-.46.58-1.02,1.05-1.71,1.43-.63.34-1.44.52-2.42.52-1.69,0-3.14-.56-4.44-1.72-1.27-1.13-1.88-2.71-1.88-4.86v-.9l-.84-.3c-.86-.31-1.81-.54-2.84-.7-2.14-.32-4.03-.3-6.34.04-1.28.19-2.52.57-3.7,1.14-1.2.58-2.24,1.38-3.07,2.38-.9,1.08-1.36,2.48-1.36,4.14,0,1.89.6,3.43,1.79,4.58,1.07,1.03,2.47,1.88,4.14,2.49,1.85.72,3.89,1.22,6.07,1.49,2.06.25,4.15.55,6.27.89,2.04.32,4.11.8,6.15,1.41,1.92.58,3.75,1.52,5.45,2.79,1.66,1.25,3.05,2.89,4.13,4.88,1.06,1.97,1.6,4.49,1.6,7.51,0,3.4-.69,6.33-2.05,8.72-1.37,2.4-3.23,4.38-5.53,5.88Zm45.66-47.92h-39.8v6.14h15.16v38.92h10.09v-38.92h14.55v-6.14Zm174.49,45.06v-45.06h-10.51l-11.15,27.84-11.52-27.84h-11.13v45.06h5.86v-33.71l14,33.71h1.77l13.54-34.12v34.12h9.14Zm-65.44-45.06l19.2,45.06h-11.07l-5.47-14h-19.25l-5.94,14h-37.18v-45.06h32.97v5.45h-23.15v12.03h9.83v5.72h-9.83v15.38h24.29l16.49-38.59h9.11Zm.25,24.86l-6.88-17.46-7.43,17.46h14.3Zm-62.25,20.13l.06.07h-12.33l-14.96-22.74h-5.37v22.74h-9.62v-45.06h22.63c1.86,0,3.77.19,5.66.56,1.83.36,3.5.96,4.97,1.8,1.42.82,2.55,1.89,3.46,3.28.86,1.33,1.3,3.07,1.3,5.18,0,1.59-.27,3.03-.81,4.28-.55,1.25-1.3,2.35-2.21,3.25-.94.91-2.09,1.68-3.43,2.27-1.37.61-2.87,1.08-4.46,1.38l-2.02.38,17.12,22.61Zm-21.49-28.73c1.91,0,3.52-.31,4.78-.91,1.08-.52,2.36-1.67,2.36-4.26,0-1.06-.24-1.97-.72-2.7-.46-.71-1.08-1.27-1.83-1.64-.67-.33-1.44-.56-2.28-.67-.76-.1-1.53-.15-2.32-.15h-11.11v10.33h11.11Zm154.1-16.25v45.06h34.67v-7.22h-24.17v-37.83h-10.5Zm40.34,0v45.06h10.23v-45.06h-10.23Zm47.82,45.06v-45.06h-5.79v24.11l-17.36-24.11h-9.14v45.06h6.81v-31.68l23.9,31.68h1.57Zm24.69-21.85v-5.72h-9.83v-12.03h23.15v-5.45h-32.96v45.06h33.78v-6.47h-23.97v-15.38h9.83Zm-243.54,52.55c-1.49-1.46-4.34-3.44-8.72-6.04l-9.84-5.85-1.26,2.12.45.27c1.78,1.06,2.11,1.33,2.15,1.37.23.25.34.5.34.76,0,.05-.04.35-.62,1.33l-7.98,13.41c-.51.85-.7,1-.71,1.01-.14.09-.31.13-.52.13h-.13c-.3-.03-.65-.16-1.03-.39l-1.91-1.16-1.26,2.11,13.89,8.26c1.65.98,3.4,1.82,5.21,2.49,1.76.66,3.44.99,5,.99h.21c1.96-.03,3.84-.5,5.57-1.42,1.75-.92,3.15-2.24,4.15-3.93,1.47-2.48,1.88-5.24,1.22-8.2-.6-2.66-2.02-5.11-4.22-7.26Zm-9.49,16.94c-.4,0-.79-.03-1.16-.09-.65-.11-1.67-.47-3.02-1.08-1.39-.62-2.36-1.1-2.9-1.42l-5.24-3.12,9.54-16.03,3.42,2.03c1.6.95,2.75,1.67,3.39,2.12,1.17.83,2.16,1.75,2.92,2.72.76.96,1.34,2.06,1.71,3.25.37,1.19.5,2.36.36,3.48-.13,1.12-.57,2.31-1.3,3.53-.74,1.24-1.6,2.23-2.56,2.95-.96.71-2.02,1.2-3.15,1.44-.7.15-1.37.22-1.99.22Zm33.97-7.31l12.3,3.38-.65,2.37-1.38-.38c-.73-.2-1.27-.28-1.62-.22-.3.05-.54.17-.71.36-.09.1-.33.43-.64,1.56l-3.98,14.5c-.23.83-.19,1.2-.15,1.35.07.25.2.45.41.61.13.1.51.32,1.54.6l1.37.37-.65,2.38-12.31-3.38.65-2.37,1.44.4c.75.21,1.29.3,1.62.25.27-.03.47-.12.62-.27.08-.08.28-.36.54-1.29l4.08-14.84c.28-1.01.25-1.38.23-1.49-.05-.21-.17-.38-.38-.54-.17-.13-.58-.34-1.53-.6l-1.44-.39.65-2.37Zm53.36,22.24c.44.81.64,1.7.61,2.63-.08,2.03-1.3,3.77-3.63,5.17-2.06,1.24-4.66,1.86-7.72,1.86-.3,0-.59,0-.9-.02-1.79-.07-3.39-.33-4.79-.78-1.25-.4-2.59-1.06-4-1.95l-.98,1.96-2.29-.09-1.91-9.42,3.01-.35.16.36c.65,1.51,1.56,2.81,2.69,3.88,1.14,1.08,2.43,1.92,3.84,2.5,1.41.58,2.87.9,4.36.96,1.99.1,3.78-.32,5.3-1.18,1.18-.67,1.78-1.45,1.81-2.36.03-.84-.33-1.52-1.12-2.1-.88-.64-2.54-1.28-4.93-1.91l-5.43-1.41c-3.16-.82-5.32-1.8-6.61-2.97-1.33-1.21-1.97-2.6-1.92-4.13.05-1.2.55-2.3,1.49-3.27.91-.93,2.28-1.7,4.07-2.27,1.77-.57,3.71-.81,5.78-.73,1.73.06,3.4.36,4.98.88.94.31,1.83.72,2.65,1.22l.86-1.37,2.27.08,2.33,8.2-2.99.57-.19-.32c-1.16-1.98-2.75-3.58-4.75-4.77-1.63-.99-3.48-1.52-5.52-1.6-1.22-.06-2.32.08-3.3.37-.94.28-1.66.67-2.13,1.14-.44.45-.66.88-.68,1.33-.02.4.13.8.43,1.2.33.44.85.85,1.57,1.21.75.39,2.03.82,3.8,1.29l5.67,1.51c.72.19,1.72.53,3.07,1.03,1.35.51,2.42,1.05,3.19,1.6.79.57,1.41,1.27,1.84,2.07Zm48.37-6.61l2.96.72-.31.6c-.65,1.25-1.42,2.38-2.3,3.35-1.37,1.55-2.9,2.84-4.55,3.82-1.64.99-3.56,1.75-5.69,2.29-1.77.44-3.5.66-5.11.66-2.69,0-5.21-.62-7.47-1.83-3.05-1.63-4.98-4.05-5.76-7.18-.57-2.3-.4-4.58.52-6.79.91-2.18,2.44-4.14,4.56-5.81,2.11-1.67,4.57-2.86,7.31-3.54,1.47-.36,2.89-.55,4.22-.56h0c1.22,0,2.43.13,3.67.4l.28-1.46,2.22-.55,5.12,7.69-2.75,1.34-.27-.26c-1.47-1.45-2.55-2.4-3.22-2.84-1.07-.69-2.34-1.15-3.75-1.36-1.42-.21-2.92-.13-4.48.26-1.83.45-3.44,1.26-4.78,2.39-1.33,1.12-2.31,2.53-2.9,4.2-.59,1.66-.66,3.4-.21,5.19.46,1.84,1.36,3.38,2.66,4.58,1.32,1.2,2.91,2,4.74,2.37,1.85.37,3.76.32,5.67-.15,1.81-.45,3.59-1.32,5.29-2.59,1.7-1.27,3.09-2.81,4.12-4.59l.2-.34Zm43.71-15.74c-1.13,2.38-3.19,4.51-6.14,6.32-1.51.93-3,1.6-4.41,2.01-1.27.36-2.75.56-4.41.6l.27,2.17-1.95,1.2-6.82-6.78,2.31-1.96.33.21c1.38.89,2.86,1.47,4.4,1.73,1.55.26,3.09.24,4.59-.05s2.89-.84,4.16-1.62c1.7-1.04,2.96-2.36,3.75-3.92.61-1.22.68-2.19.2-2.97-.44-.71-1.12-1.08-2.1-1.13h-.16c-1.09,0-2.77.38-4.99,1.14l-5.3,1.84c-3.05,1.06-5.47,1.44-7.14,1.2-1.78-.27-3.09-1.07-3.89-2.37-.63-1.02-.82-2.21-.58-3.54.23-1.28.95-2.68,2.12-4.15,1.16-1.45,2.64-2.74,4.4-3.82,1.47-.9,3.02-1.59,4.63-2.03.95-.27,1.92-.42,2.88-.46l-.05-1.62,1.93-1.18,6.49,5.52-2.17,2.13-.33-.16c-2.06-1-4.28-1.47-6.6-1.33-1.91.09-3.75.67-5.48,1.73-1.03.64-1.89,1.36-2.54,2.15-.63.76-1.01,1.47-1.14,2.13-.12.62-.06,1.1.17,1.48.21.34.55.59,1.03.76.51.18,1.17.23,1.97.14.84-.1,2.14-.45,3.88-1.04l5.55-1.89c.7-.24,1.72-.51,3.13-.84,1.3-.3,2.36-.45,3.26-.45h.28c.97.04,1.87.28,2.67.71.82.43,1.48,1.06,1.97,1.85,1.06,1.73,1.01,3.86-.15,6.31Z"/>
            </svg>
            </div>
            <div className="text-sm font-semibold mt-2">{user.name}</div>
            <div className="text-xs text-gray-500">Full Stack Developer Intern</div>
            <div className="flex flex-row items-center mt-3">
                <Link onClick={() => logoutUser()} to="/signin" className="flex justify-center items-center  text-gray-800 dark:text-white hover:bg-gray-50 focus:ring-4 focus:ring-gray-300 font-medium rounded-lg text-sm px-4 lg:px-5 py-2 lg:py-2.5 mr-2 dark:hover:bg-gray-700 focus:outline-none dark:focus:ring-gray-800">
                Logout
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className="w-4 h-4 mt-1">
                    <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" />
                </svg>
                </Link>
            </div>
            </div>
            <div className="mt-2">
                <Notification/>
            </div>
            
            <div className="flex flex-col mt-8">
            <div className="flex flex-row items-center justify-between text-xs">
                <span className="font-bold">Chat list</span>
                <span
                className="flex items-center justify-center bg-gray-300 h-4 w-4 rounded-full"
                >
                    {allUserValue - 1}
                </span
                >
            </div>
            {/* chat list */}
            <div className="flex flex-col space-y-1 mt-4 -mx-2 h-48 overflow-y-auto">
                {/* test */} 
                    {isUserChatsLoading && <p>Loading Chats...</p>}
                    {userChats?.map((chat, index) => {
                        return (
                            <button onClick={() => updateCurrentChat(chat)} key={index} className="flex flex-row items-center hover:bg-gray-100 rounded-xl p-2">
                                <UserChat chat={chat} user={user}/>
                            </button>
                        )
                    })}
           
            {/* endtest */}
            <div className="flex flex-col space-y-1">
                <FutureChat/>
            </div>
            </div>
            {/* Future chat */}
           
            </div>
        </div>
     
        <div className="flex flex-col flex-auto h-full p-6">
            <Chatbox/>
        </div>
        </div>
    </div>
    </div>
        {/* } */}
        
        </>
    )
}
 
export default Chat;